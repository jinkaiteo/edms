# EDMS Deployment Prerequisites & Complete Guide

## ğŸ“‹ Executive Summary

**Script**: `deploy-interactive.sh` (993 lines)  
**Status**: âœ… **READY TO USE** (Critical fix applied)  
**Estimated Time**: 10-20 minutes  
**Difficulty**: Easy (Interactive prompts guide you)  

---

## âœ… All Systems Go - Verification Complete

### Critical Issues: FIXED âœ…

| Issue | Status | Details |
|-------|--------|---------|
| **DB_HOST value** | âœ… **FIXED** | Changed from 'postgres' to 'db' (line 456) |
| docker-compose.prod.yml | âœ… EXISTS | All services defined |
| Required scripts | âœ… ALL EXIST | 3/3 scripts present |
| Management commands | âœ… ALL EXIST | 4/4 commands available |
| cryptography package | âœ… AVAILABLE | Fernet key generation works |

---

## ğŸš€ Quick Start (For Experienced Users)

```bash
# 1. Run the deployment script
./deploy-interactive.sh

# 2. Follow the prompts:
#    - Server IP: [auto-detected]
#    - Ports: [use defaults: 8001, 3001, 5433, 6380]
#    - Database credentials: [create strong password]
#    - HAProxy: [y/n based on your setup]

# 3. Wait for completion (~15 minutes)

# 4. Access your EDMS:
#    Frontend: http://your-server-ip:3001
#    Backend API: http://your-server-ip:8001/api/
#    Admin Panel: http://your-server-ip:8001/admin/
```

---

## ğŸ“¦ Prerequisites

### System Requirements

**Minimum**:
- CPU: 2 cores
- RAM: 4GB
- Disk: 20GB free space
- OS: Ubuntu 20.04+ / Debian 11+ / CentOS 8+

**Recommended**:
- CPU: 4+ cores
- RAM: 8GB+
- Disk: 50GB+ SSD
- OS: Ubuntu 22.04 LTS

### Required Software

âœ… **All verified present on your system:**

1. **Docker** âœ…
   ```bash
   docker --version
   # Docker version 20.10.0 or newer
   ```

2. **Docker Compose** âœ…
   ```bash
   docker compose version
   # Docker Compose version 2.x or newer
   ```

3. **Python 3** âœ…
   ```bash
   python3 --version
   # Python 3.8 or newer
   ```

4. **cryptography package** âœ…
   ```bash
   python3 -c "from cryptography.fernet import Fernet"
   # Should not error
   ```

5. **Git** âœ… (optional)
   ```bash
   git --version
   ```

---

## ğŸ“ Required Files

### âœ… All Verified Present

```
âœ… deploy-interactive.sh                    # Main deployment script (FIXED)
âœ… docker-compose.prod.yml                  # Docker services definition
âœ… scripts/create-test-users.sh             # Creates test users
âœ… scripts/initialize-workflow-defaults.sh  # Sets up workflows
âœ… scripts/fix-reviewer-approver-roles.sh   # Assigns user roles
âœ… backend/.env.example                     # Environment template
âœ… .env.production.template                 # NEW: Complete template
```

### Management Commands (Django)

```
âœ… create_default_roles                     # Creates 7 default roles
âœ… create_default_groups                    # Creates 6 Django groups
âœ… create_default_document_types            # Creates 6 document types
âœ… create_default_document_sources          # Creates 3 document sources
```

---

## ğŸ” Security Preparation

### Passwords & Secrets Checklist

Before running the script, prepare these:

- [ ] **Database Password** (minimum 12 characters)
  - Requirements: Mixed case, numbers, special characters
  - Example: `MyStr0ng!DbP@ssw0rd2024`
  
- [ ] **Admin User Credentials**
  - Username: (you'll choose during deployment)
  - Password: (minimum 12 characters)
  - Email: (your admin email)

**Auto-Generated by Script**:
- âœ… Django SECRET_KEY (50 characters)
- âœ… EDMS_MASTER_KEY (44 characters, Fernet key)

---

## ğŸ“Š What the Script Will Do

### Step-by-Step Process

#### 1. **Pre-flight Checks** (~1 minute)
- Verify Docker installed and running
- Check disk space (10GB+ recommended)
- Verify required commands available
- Check for required files

#### 2. **Configuration Collection** (~3 minutes)
Interactive prompts for:
- Server IP address (auto-detected)
- Server hostname (optional)
- Docker ports (defaults provided)
- Database name, user, password
- Session timeout
- HAProxy configuration (optional)
- Sentry DSN (optional)

#### 3. **Configuration Review** (~1 minute)
- Review all entered settings
- Confirm before proceeding
- Option to cancel and restart

#### 4. **Environment File Creation** (~10 seconds)
- Generate secure .env file
- Set file permissions to 600
- Backup existing .env if present

#### 5. **Docker Deployment** (~5 minutes)
- Build Docker images
- Start all containers:
  - PostgreSQL database
  - Redis cache
  - Backend (Django)
  - Frontend (React)
  - Celery worker
  - Celery beat
- Wait for services to be ready

#### 6. **Database Initialization** (~3 minutes)
- Run Django migrations
- Collect static files
- Create default roles (7 roles)
- Create default groups (6 groups)
- Create test users (admin, author01, reviewer01, approver01)
- Create document types (6 types)
- Create document sources (3 sources)
- Initialize workflow defaults
- Assign roles to test users

#### 7. **Admin User Creation** (~1 minute)
- Interactive superuser creation
- Or skip and create later

#### 8. **System Testing** (~1 minute)
- Test backend health endpoint
- Test frontend accessibility
- Check container logs for errors

#### 9. **HAProxy Setup** (~2 minutes, optional)
- Install HAProxy
- Generate configuration
- Provide setup instructions

#### 10. **Final Summary**
- Display access URLs
- Show container management commands
- Provide documentation links

---

## ğŸ¯ Default Configuration Values

### What the Script Uses by Default

```yaml
Server Configuration:
  IP Address: [auto-detected]
  Hostname: edms-server

Docker Ports:
  Backend: 8001
  Frontend: 3001
  PostgreSQL: 5433
  Redis: 6380

Database:
  Name: edms_production
  User: edms_prod_user
  Password: [you provide]
  Host: db  # Docker service name (FIXED!)
  Port: 5432  # Internal

Security:
  Session Timeout: 3600 seconds (1 hour)
  SESSION_COOKIE_HTTPONLY: True
  CSRF_COOKIE_HTTPONLY: True

Performance:
  DB_CONN_MAX_AGE: 60 seconds
  DB_MAX_CONNECTIONS: 20
  CACHE_TTL: 900 seconds (15 minutes)

JWT:
  Access Token Lifetime: 8 hours
  Refresh Token Lifetime: 1 day
  Rotate Refresh Tokens: True
```

---

## ğŸ”§ Customization Options

### During Interactive Prompts

You can customize:
- âœ… All port numbers
- âœ… Database credentials
- âœ… Session timeout duration
- âœ… Enable/disable HAProxy
- âœ… HAProxy port (80 or 443)
- âœ… Sentry error tracking

### After Deployment

You can modify `backend/.env` file:
- Email configuration (SMTP)
- Logging level
- Additional CORS origins
- Performance tuning parameters

---

## ğŸš€ Deployment Execution

### Running the Script

```bash
# Make sure you're in the project root
cd /path/to/edms

# Run the deployment script
./deploy-interactive.sh
```

### Sample Session

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                               â•‘
â•‘     EDMS Interactive Deployment Script                       â•‘
â•‘     Enterprise Document Management System                    â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â„¹ This script will guide you through deploying EDMS.
â„¹ Estimated time: 10-20 minutes

? Ready to begin? [Y/n]: y

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Pre-flight Checks
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¶ Checking required commands...
âœ“ Docker installed: 24.0.7
âœ“ Docker Compose installed
âœ“ Python3 installed: 3.11.6
âœ“ Git installed: 2.40.1

â–¶ Checking Docker service...
âœ“ Docker service is running

â–¶ Checking disk space...
âœ“ Available disk space: 45GB

âœ“ All pre-flight checks passed!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Configuration Collection
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â–¶ Detecting server IP address...
âœ“ Detected IP: 192.168.1.100

â–¶ Server Configuration

? Server IP address [192.168.1.100]: 
? Server hostname (optional) [edms-server]: 

â–¶ Docker Port Configuration

? Backend port [8001]: 
? Frontend port [3001]: 
? PostgreSQL port [5433]: 
? Redis port [6380]: 

â–¶ Database Configuration

? Database name [edms_production]: 
? Database user [edms_prod_user]: 
? Database password: ****************
? Confirm password: ****************

... [continues with all prompts]
```

---

## âœ… Post-Deployment Verification

### 1. Check Container Status

```bash
docker compose -f docker-compose.prod.yml ps
```

Expected output:
```
NAME                STATUS              PORTS
edms_prod_backend   Up About a minute   0.0.0.0:8001->8000/tcp
edms_prod_frontend  Up About a minute   0.0.0.0:3001->80/tcp
edms_prod_db        Up About a minute   0.0.0.0:5433->5432/tcp
edms_prod_redis     Up About a minute   0.0.0.0:6380->6379/tcp
...
```

### 2. Test Backend Health

```bash
curl http://localhost:8001/health/
```

Expected: `{"status": "healthy", ...}`

### 3. Test Frontend

```bash
curl -I http://localhost:3001/
```

Expected: `HTTP/1.1 200 OK`

### 4. Access Web Interface

Open browser: `http://your-server-ip:3001`

**Test Users Created**:
- Username: `admin` / Password: [your admin password]
- Username: `author01` / Password: `author01pass`
- Username: `reviewer01` / Password: `reviewer01pass`
- Username: `approver01` / Password: `approver01pass`

---

## ğŸ”§ Troubleshooting

### Common Issues

**Issue**: "Docker service is not running"
```bash
sudo systemctl start docker
sudo systemctl enable docker
```

**Issue**: "Port already in use"
```bash
# Check what's using the port
sudo lsof -i :8001

# Either stop that service or choose different port
```

**Issue**: "Permission denied" on deploy script
```bash
chmod +x deploy-interactive.sh
```

**Issue**: Container failed to start
```bash
# Check logs
docker compose -f docker-compose.prod.yml logs backend

# Restart specific service
docker compose -f docker-compose.prod.yml restart backend
```

---

## ğŸ“š Generated Files

After successful deployment:

```
backend/.env                         # Production environment variables (600 perms)
backend/.env.backup.YYYYMMDD-HHMMSS # Backup of previous .env (if existed)
/tmp/edms-haproxy.cfg               # HAProxy config (if enabled)
```

---

## ğŸ¯ Next Steps After Deployment

1. **Test the Application**
   - Login with admin credentials
   - Create a test document
   - Test workflow functionality

2. **Configure Email** (Phase 2)
   - Edit `backend/.env`
   - Set EMAIL_HOST, EMAIL_PORT, etc.
   - Restart backend: `docker compose -f docker-compose.prod.yml restart backend`

3. **Set Up Backups**
   ```bash
   # Manual backup
   ./scripts/backup-hybrid.sh
   
   # Automated backups (already configured via cron)
   crontab -l | grep backup
   ```

4. **Configure HAProxy** (if enabled)
   - Follow instructions in: `HAPROXY_INTEGRATION_GUIDE.md`
   - Copy generated config: `sudo cp /tmp/edms-haproxy.cfg /etc/haproxy/haproxy.cfg`
   - Restart HAProxy: `sudo systemctl restart haproxy`

5. **SSL/TLS Setup** (optional)
   - See: `HAPROXY_INTEGRATION_GUIDE.md` for HTTPS setup

6. **Create Additional Users**
   - Use Admin Panel: `http://your-server-ip:8001/admin/`
   - Or Frontend: `http://your-server-ip:3001/admin`

---

## ğŸ“Š System Architecture

After deployment, your system will have:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Host Machine (your-server-ip)                      â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  HAProxy :80 (optional)                    â”‚    â”‚
â”‚  â”‚    â”œâ”€> Frontend :3001                      â”‚    â”‚
â”‚  â”‚    â””â”€> Backend :8001 (API endpoints)       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Docker Containers                          â”‚    â”‚
â”‚  â”‚                                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”‚
â”‚  â”‚  â”‚  Frontend    â”‚  â”‚  Backend     â”‚        â”‚    â”‚
â”‚  â”‚  â”‚  (React)     â”‚  â”‚  (Django)    â”‚        â”‚    â”‚
â”‚  â”‚  â”‚  Port: 3001  â”‚  â”‚  Port: 8001  â”‚        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚
â”‚  â”‚                                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”‚
â”‚  â”‚  â”‚  PostgreSQL  â”‚  â”‚  Redis       â”‚        â”‚    â”‚
â”‚  â”‚  â”‚  Port: 5433  â”‚  â”‚  Port: 6380  â”‚        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚
â”‚  â”‚                                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”‚
â”‚  â”‚  â”‚ Celery Workerâ”‚  â”‚ Celery Beat  â”‚        â”‚    â”‚
â”‚  â”‚  â”‚              â”‚  â”‚ (Scheduler)  â”‚        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚
â”‚  â”‚                                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŠ Conclusion

### You're Ready to Deploy! âœ…

**All systems verified**:
- âœ… Script fixed (DB_HOST corrected)
- âœ… All prerequisites present
- âœ… All required files exist
- âœ… All dependencies available
- âœ… Complete documentation provided

**Run this command when ready**:
```bash
./deploy-interactive.sh
```

**Estimated total time**: 15-20 minutes

**Result**: Fully functional EDMS with:
- Web interface
- API endpoints
- Document management
- Workflow system
- User authentication
- Role-based access control
- Automated backups

---

## ğŸ“ Support

**Documentation Files**:
- `DEPLOYMENT_SCRIPT_ANALYSIS.md` - Comprehensive script analysis
- `DEPLOY_INTERACTIVE_FIXES.md` - Fixes applied
- `.env.production.template` - Environment variable template
- `HAPROXY_INTEGRATION_GUIDE.md` - HAProxy setup
- `BACKUP_RESTORE_FINAL_SUMMARY.md` - Backup system guide

**Quick Commands**:
```bash
# View logs
docker compose -f docker-compose.prod.yml logs -f

# Restart services
docker compose -f docker-compose.prod.yml restart

# Stop all
docker compose -f docker-compose.prod.yml down

# Check status
docker compose -f docker-compose.prod.yml ps
```

---

**Good luck with your deployment!** ğŸš€

